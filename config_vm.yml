---
-   hosts: oaisim-enB
    become: yes
    remote_user: root
    vars:
        COPY_RIGHT: 'ciromacedo@gmail.com'
    tasks:
        - name : Remove grub default file
          ignore_errors: true
          shell:  | 
                rm /etc/default/grub 
       
        - name : Remove blacklist.conf default file
          ignore_errors: true
          shell:  | 
                rm /etc/modprobe.d/blacklist.conf 
        
        - name : Remove cpufrequtils default file if exist
          ignore_errors: true
          shell:  | 
                rm /etc/default/cpufrequtils 
        
        - name  : Generate new blacklist.conf file
          copy:
            dest: "/etc/modprobe.d/blacklist.conf"
            content: |
                # This file lists those modules which we don't want to be loaded by
                # alias expansion, usually so some other driver will be loaded for the
                # device instead.

                # evbug is a debug tool that should be loaded explicitly
                blacklist evbug

                # these drivers are very simple, the HID drivers are usually preferred
                blacklist usbmouse
                blacklist usbkbd

                # replaced by e100
                blacklist eepro100

                # replaced by tulip
                blacklist de4x5

                # causes no end of confusion by creating unexpected network interfaces
                blacklist eth1394

                # snd_intel8x0m can interfere with snd_intel8x0, doesn't seem to support much
                # hardware on its own (Ubuntu bug #2011, #6810)
                blacklist snd_intel8x0m

                # Conflicts with dvb driver (which is better for handling this device)
                blacklist snd_aw2

                # Causes trackpads to stop working on Lenovo 11e 2nd gen (Ubuntu: #1802135)
                # and Lenovo x240 to hang on boot (Ubuntu: #1802689)
                blacklist i2c_i801

                # replaced by p54pci
                blacklist prism54

                # replaced by b43 and ssb.
                blacklist bcm43xx

                # most apps now use garmin usb driver directly (Ubuntu: #114565)
                blacklist garmin_gps

                # replaced by asus-laptop (Ubuntu: #184721)
                blacklist asus_acpi

                # low-quality, just noise when being used for sound playback, causes
                # hangs at desktop session start (Ubuntu: #246969)
                blacklist snd_pcsp

                # ugly and loud noise, getting on everyone's nerves; this should be done by a
                # nice pulseaudio bing (Ubuntu: #77010)
                blacklist pcspkr

                # EDAC driver for amd76x clashes with the agp driver preventing the aperture
                # from being initialised (Ubuntu: #297750). Blacklist so that the driver
                # continues to build and is installable for the few cases where its
                # really needed.
                blacklist amd76x_edac

                blacklist intel_powerclamp

        - name  : Generate new grub file
          copy:
            dest: "/etc/default/grub"
            content: |
                # If you change this file, run 'update-grub' afterwards to update
                # /boot/grub/grub.cfg.
                # For full documentation of the options in this file, see:
                #   info -f grub -n 'Simple configuration'

                GRUB_DEFAULT=0
                GRUB_HIDDEN_TIMEOUT=0
                GRUB_HIDDEN_TIMEOUT_QUIET=true
                GRUB_TIMEOUT=10
                GRUB_DISTRIBUTOR=`lsb_release -i -s 2> /dev/null || echo Debian`
                GRUB_CMDLINE_LINUX_DEFAULT="processor.max_cstate=1 intel_idle.max_cstate=0 idle=poll"
                GRUB_CMDLINE_LINUX=""

                # Uncomment to enable BadRAM filtering, modify to suit your needs
                # This works with Linux (no patch required) and with any kernel that obtains
                # the memory map information from GRUB (GNU Mach, kernel of FreeBSD ...)
                #GRUB_BADRAM="0x01234567,0xfefefefe,0x89abcdef,0xefefefef"

                # Uncomment to disable graphical terminal (grub-pc only)
                #GRUB_TERMINAL=console

                # The resolution used on graphical terminal
                # note that you can use only modes which your graphic card supports via VBE
                # you can see them in real GRUB with the command `vbeinfo'
                #GRUB_GFXMODE=640x480

                # Uncomment if you don't want GRUB to pass "root=UUID=xxx" parameter to Linux
                #GRUB_DISABLE_LINUX_UUID=true

                # Uncomment to disable generation of recovery mode menu entries
                #GRUB_DISABLE_RECOVERY="true"

                # Uncomment to get a beep at grub start
                #GRUB_INIT_TUNE="480 440 1"

        - name  : Install cpufrequtils
          become: true
          shell:  |
                sudo apt-get install cpufrequtils -y
                sudo apt-get install i7z -y

        - name  : Generate new cpufrequtils file
          copy:
            dest: "/etc/default/cpufrequtils"
            content: |
                GOVERNOR="performance"

        - name  : Update grub
          shell: | 
             update-grub
             sudo update-rc.d ondemand disable
             sudo /etc/init.d/cpufrequtils restart

        - name  : Install git if not exist
          apt:
            name: git
            state: present
            update_cache: yes