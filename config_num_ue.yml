---
-   hosts: oaisim-enB
    become: yes
    remote_user: root
    vars:
        COPY_RIGHT: 'ciromacedo@gmail.com'
        num_user_equipment: '1'
        BASE_DIR_INSTALL_UE : "ansible_ue"
    tasks:

        - name  : Config Nº UE's - Remove ue_eurecom_test_sfr.conf file
          shell:  rm openairinterface5g/openair3/NAS/TOOLS/ue_eurecom_test_sfr.conf 
          args:
            chdir: "{{ BASE_DIR_INSTALL_UE }}" 
        
        - name  : Config Nº UE's - Build ue.nfapi.conf file
          copy:
            dest: "{{ BASE_DIR_INSTALL_UE }}/openairinterface5g/openair3/NAS/TOOLS/ue_eurecom_test_sfr.conf"
            content: |
              # List of known PLMNS
              PLMN: {
                  PLMN0: {
                        FULLNAME="Test network";
                        SHORTNAME="OAI4G";
                        MNC="01";
                        MCC="001";

                  };
                  PLMN1: {
                        FULLNAME="SFR France";
                        SHORTNAME="SFR";
                        MNC="10";
                        MCC="208";

                  };
                  PLMN2: {
                        FULLNAME="SFR France";
                        SHORTNAME="SFR";
                        MNC="11";
                        MCC="208";
                  };
                  PLMN3: {
                        FULLNAME="SFR France";
                        SHORTNAME="SFR";
                        MNC="13";
                        MCC="208";
                  };
                  PLMN4: {
                        FULLNAME="OAI LTEBOX";
                        SHORTNAME="OAIALU";
                        MNC="93";
                        MCC="208";
                  };
                  PLMN5: {
                        FULLNAME="T-Mobile USA";
                        SHORTNAME="T-Mobile";
                        MNC="280";
                        MCC="310";
                  };
                  PLMN6: {
                        FULLNAME="FICTITIOUS USA";
                        SHORTNAME="FICTITIO";
                        MNC="028";
                        MCC="310";
                  };
                  PLMN7: {
                        FULLNAME="Vodafone Italia";
                        SHORTNAME="VODAFONE";
                        MNC="10";
                        MCC="222";
                  };
                  PLMN8: {
                        FULLNAME="Vodafone Spain";
                        SHORTNAME="VODAFONE";
                        MNC="01";
                        MCC="214";
                  };
                  PLMN9: {
                        FULLNAME="Vodafone Spain";
                        SHORTNAME="VODAFONE";
                        MNC="06";
                        MCC="214";
                  };
                  PLMN10: {
                        FULLNAME="Vodafone Germ";
                        SHORTNAME="VODAFONE";
                        MNC="02";
                        MCC="262";
                  };
                  PLMN11: {
                        FULLNAME="Vodafone Germ";
                        SHORTNAME="VODAFONE";
                        MNC="04";
                        MCC="262";
                  };
              };

        - name: Add Ue's
          blockinfile:
            path: /root/{{ BASE_DIR_INSTALL_UE }}/openairinterface5g/openair3/NAS/TOOLS/ue_eurecom_test_sfr.conf
            block: |
                {{ item.id }}:
                  {
                      USER: {
                          IMEI="356113022094149";
                          MANUFACTURER="EURECOM";
                          MODEL="LTE Android PC";
                          PIN="0000";
                      };

                      SIM: {
                          MSIN="0000000031";
                          USIM_API_K="8baf473f2f8fd09487cccbd7097c6862";
                          OPC="e734f8734007d6c5ce7a0508809e7e9c";
                          MSISDN="33638020004";
                      };
                      HPLMN= "20893";
                      UCPLMN_LIST = ();
                      OPLMN_LIST = ("00101", "20810", "20811", "20813", "20893", "310280", "310028");
                      OCPLMN_LIST = ("22210", "21401", "21406", "26202", "26204");
                      FPLMN_LIST = ();
                      EHPLMN_LIST= ();
                  };
          loop:
            - { id: UE0 }
            - { id: UE1 }
            - { id: UE2 }
            - { id: UE3 }
          loop_control:
            index_var: my_idx

#           echo "Teste $i " >> {{ BASE_DIR_INSTALL_UE }}/openairinterface5g/openair3/NAS/TOOLS/ue_eurecom_test_sfr.conf
#       - name: count our fruit
#           msg: "{{ item }} with index {{ my_idx }}"
#          loop:
#            - apple
#            - banana
#            - pear
#          loop_control:
#            index_var: my_idx